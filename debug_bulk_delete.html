<!DOCTYPE html>
<html>
<head>
    <title>Debug Bulk Delete</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>
    <style>
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            margin: 5px;
            padding: 10px 15px;
        }
        .log {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Bulk Delete Debug Tool</h2>
        
        <div class="debug-section">
            <h3>1. Test Sales Bulk Delete</h3>
            <p>This will test the sales bulk delete functionality:</p>
            <button class="btn btn-danger test-button" onclick="testSalesBulkDelete()">Test Sales Bulk Delete</button>
            <div id="sales-log" class="log"></div>
        </div>
        
        <div class="debug-section">
            <h3>2. Test Customers Bulk Delete</h3>
            <p>This will test the customers bulk delete functionality:</p>
            <button class="btn btn-danger test-button" onclick="testCustomersBulkDelete()">Test Customers Bulk Delete</button>
            <div id="customers-log" class="log"></div>
        </div>
        
        <div class="debug-section">
            <h3>3. Check Routes</h3>
            <p>Check if the bulk delete routes are accessible:</p>
            <button class="btn btn-info test-button" onclick="checkRoutes()">Check Routes</button>
            <div id="routes-log" class="log"></div>
        </div>
        
        <div class="debug-section">
            <h3>4. Simulate Frontend</h3>
            <p>Simulate the frontend bulk delete functionality:</p>
            <div>
                <input type="checkbox" class="invoice_checkbox" value="1"> Sale ID 1
                <input type="checkbox" class="invoice_checkbox" value="2"> Sale ID 2
                <input type="checkbox" class="invoice_checkbox" value="3"> Sale ID 3
            </div>
            <br>
            <button class="btn btn-primary test-button" onclick="simulateFrontend()">Simulate Frontend Delete</button>
            <div id="frontend-log" class="log"></div>
        </div>
    </div>

    <script>
        function log(section, message) {
            var timestamp = new Date().toLocaleTimeString();
            $('#' + section + '-log').append('[' + timestamp + '] ' + message + '\n');
            $('#' + section + '-log').scrollTop($('#' + section + '-log')[0].scrollHeight);
        }

        function testSalesBulkDelete() {
            log('sales', 'üîç Testing Sales Bulk Delete...');
            
            // Test with fake IDs
            var testData = {
                '_token': 'test-token',
                'selected_ids': [999, 998, 997] // Non-existent IDs for testing
            };
            
            $.ajax({
                method: 'POST',
                url: '/sells/bulk-delete',
                data: testData,
                dataType: 'json',
                success: function(result) {
                    log('sales', '‚úÖ SUCCESS: ' + JSON.stringify(result));
                },
                error: function(xhr, status, error) {
                    log('sales', '‚ùå ERROR: ' + xhr.status + ' - ' + xhr.statusText);
                    log('sales', 'Response: ' + xhr.responseText);
                }
            });
        }

        function testCustomersBulkDelete() {
            log('customers', 'üîç Testing Customers Bulk Delete...');
            
            // Test with fake IDs
            var testData = {
                '_token': 'test-token',
                'selected_ids': [999, 998, 997] // Non-existent IDs for testing
            };
            
            $.ajax({
                method: 'POST',
                url: '/contacts/bulk-delete',
                data: testData,
                dataType: 'json',
                success: function(result) {
                    log('customers', '‚úÖ SUCCESS: ' + JSON.stringify(result));
                },
                error: function(xhr, status, error) {
                    log('customers', '‚ùå ERROR: ' + xhr.status + ' - ' + xhr.statusText);
                    log('customers', 'Response: ' + xhr.responseText);
                }
            });
        }

        function checkRoutes() {
            log('routes', 'üîç Checking Routes...');
            
            // Check sales route
            $.ajax({
                method: 'GET',
                url: '/sells/bulk-delete',
                success: function() {
                    log('routes', '‚úÖ Sales route accessible (GET)');
                },
                error: function(xhr) {
                    if (xhr.status === 405) {
                        log('routes', '‚úÖ Sales route exists (Method not allowed for GET - expected)');
                    } else {
                        log('routes', '‚ùå Sales route error: ' + xhr.status);
                    }
                }
            });
            
            // Check customers route
            $.ajax({
                method: 'GET',
                url: '/contacts/bulk-delete',
                success: function() {
                    log('routes', '‚úÖ Customers route accessible (GET)');
                },
                error: function(xhr) {
                    if (xhr.status === 405) {
                        log('routes', '‚úÖ Customers route exists (Method not allowed for GET - expected)');
                    } else {
                        log('routes', '‚ùå Customers route error: ' + xhr.status);
                    }
                }
            });
        }

        function simulateFrontend() {
            log('frontend', 'üîç Simulating Frontend Functionality...');
            
            // Check if checkboxes exist
            var checkboxes = $('.invoice_checkbox');
            log('frontend', 'Found ' + checkboxes.length + ' checkboxes');
            
            // Check selected checkboxes
            var selectedIds = [];
            $('.invoice_checkbox:checked').each(function() {
                selectedIds.push($(this).val());
            });
            
            log('frontend', 'Selected IDs: ' + JSON.stringify(selectedIds));
            
            if (selectedIds.length === 0) {
                log('frontend', '‚ö†Ô∏è No checkboxes selected. Please check some boxes above.');
                return;
            }
            
            // Simulate the AJAX call
            log('frontend', 'üì° Making AJAX request...');
            
            $.ajax({
                method: 'POST',
                url: '/sells/bulk-delete',
                data: {
                    '_token': 'test-token',
                    'selected_ids': selectedIds
                },
                dataType: 'json',
                success: function(result) {
                    log('frontend', '‚úÖ AJAX SUCCESS: ' + JSON.stringify(result));
                },
                error: function(xhr, status, error) {
                    log('frontend', '‚ùå AJAX ERROR: ' + xhr.status + ' - ' + error);
                    log('frontend', 'Response: ' + xhr.responseText);
                }
            });
        }

        $(document).ready(function() {
            log('frontend', 'üöÄ Debug tool loaded');
            log('frontend', 'jQuery version: ' + $.fn.jquery);
        });
    </script>
</body>
</html>